
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Exercises Day 2 TA &#8212; Open Ephys EEA 2022 0.0.0 documentation</title>
<script>
  document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
  document.documentElement.dataset.theme = localStorage.getItem("theme") || "light"
</script>

  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=92025949c220c2e29695" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=92025949c220c2e29695" rel="stylesheet">


  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />

  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=92025949c220c2e29695">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.png"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="docsearch:language" content="en">
  </head>
  
  
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="180" data-default-mode="">
    <div class="bd-header-announcement container-fluid" id="banner">
      

    </div>

    
    <nav class="bd-header navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="bd-header__inner container-xl">

  <div id="navbar-start">
    
    
  


<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    <p class="title logo__title">Open Ephys EEA 2022 0.0.0 documentation</p>
  
</a>
    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="fas fa-bars"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="kitlist.html">
  NeuroKit Contents
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="eeadocsindex.html">
  EEA Course Documents
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="disclaimer_terms_conditions.html">
  Terms and Conditions
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="license.html">
  Licensing
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="acknowledgements.html">
  Acknowledgements
 </a>
</li>

    
    <li class="nav-item">
        <a class="nav-link nav-external" href="https://open-ephys.org">Open Ephys<i class="fas fa-external-link-alt"></i></a>
    </li>
    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <span id="theme-switch" class="btn btn-sm btn-outline-primary navbar-btn rounded-circle">
    <a class="theme-switch" data-mode="light"><i class="fas fa-sun"></i></a>
    <a class="theme-switch" data-mode="dark"><i class="far fa-moon"></i></a>
    <a class="theme-switch" data-mode="auto"><i class="fas fa-adjust"></i></a>
</span>
      </div>
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          <a class="nav-link" href="https://github.com/ahleighton/OE-ephys-course" rel="noopener" target="_blank" title="GitHub"><span><i class="fab fa-github"></i></span>
            <label class="sr-only">GitHub</label></a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="https://twitter.com/openephys" rel="noopener" target="_blank" title="Twitter"><span><i class="fab fa-twitter"></i></span>
            <label class="sr-only">Twitter</label></a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="https://discord.gg/vSg5UDcCwB" rel="noopener" target="_blank" title="Discord"><span><i class="fab fa-discord"></i></span>
            <label class="sr-only">Discord</label></a>
        </li>
      </ul>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="bd-container container-xl">
      <div class="bd-container__inner row">
          

<!-- Only show if we have sidebars configured, else just a small margin  -->
<div class="bd-sidebar-primary col-12 col-md-3 bd-sidebar">
  <div class="sidebar-start-items"><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    
  </div>
</nav>
  </div>
  <div class="sidebar-end-items">
  </div>
</div>


          


<div class="bd-sidebar-secondary d-none d-xl-block col-xl-2 bd-toc">
  
    
    <div class="toc-item">
      
<div class="tocsection onthispage mt-5 pt-1 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#capacitor-and-resistor-in-parallel">
   1. Capacitor and Resistor in parallel
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-equivalent-circuit-of-the-electrode">
   2. The equivalent circuit of the electrode
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#shunt-impedance">
   3.  Shunt Impedance
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#recording-circuit">
     Recording Circuit
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#operational-amplifiers">
   4. Operational Amplifiers
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#bypass-capacitors">
     Bypass capacitors
    </a>
   </li>
  </ul>
 </li>
</ul>

</nav>
    </div>
    
    <div class="toc-item">
      

<div class="tocsection editthispage">
    <a href="https://github.com/ahleighton/OE-ephys-course/edit/main/source/EEA/exday2TA_nokit.rst">
        <i class="fas fa-pencil-alt"></i> Edit this page
    </a>
</div>

    </div>
    
  
</div>


          
          
          <div class="bd-content col-12 col-md-9 col-xl-7">
              
              <article class="bd-article" role="main">
                
  <section id="exercises-day-2-ta">
<span id="refeday2ta"></span><h1>Exercises Day 2 TA<a class="headerlink" href="#exercises-day-2-ta" title="Permalink to this heading">#</a></h1>
<nav class="contents local" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#capacitor-and-resistor-in-parallel" id="id1">1. Capacitor and Resistor in parallel</a></p></li>
<li><p><a class="reference internal" href="#the-equivalent-circuit-of-the-electrode" id="id2">2. The equivalent circuit of the electrode</a></p></li>
<li><p><a class="reference internal" href="#shunt-impedance" id="id3">3.  Shunt Impedance</a></p>
<ul>
<li><p><a class="reference internal" href="#recording-circuit" id="id4">Recording Circuit</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#operational-amplifiers" id="id5">4. Operational Amplifiers</a></p>
<ul>
<li><p><a class="reference internal" href="#bypass-capacitors" id="id6">Bypass capacitors</a></p></li>
</ul>
</li>
</ul>
</nav>
<section id="capacitor-and-resistor-in-parallel">
<h2><a class="toc-backref" href="#id1" role="doc-backlink">1. Capacitor and Resistor in parallel</a><a class="headerlink" href="#capacitor-and-resistor-in-parallel" title="Permalink to this heading">#</a></h2>
<p>In the circuit below, you will see a capacitor and a resistor in parallel. The voltage source alternates at 20Hz, going from -10 to +10 volts. The current travels over the resistor or via the capacitor to ground.</p>
<a class="reference external image-reference" href="https://tinyurl.com/y27sbtmr"><img alt="../_images/cap_res_parallel_sim.png" class="align-center" src="../_images/cap_res_parallel_sim.png" /></a>
<div class="exercise docutils container">
<p>1A.  Increase the value of the resistor to 200kOhm. What happens to the current through the resistor?</p>
<p>1B.  Put the resistor back to 10kOhm. Now, increase the capacitance of the capacitor to around 10mF. What happens to the current?</p>
<p>1C.  Return the values to 10kOhm and 100nF.</p>
<p>Change the frequency of the alternating signal to</p>
<ul class="simple">
<li><p>1000 Hz (action potentials!)</p></li>
<li><p>then to 1 Hz</p></li>
</ul>
<p>You may have to change the simulation speed using the red slider at the top right, and adjust the x-scaling of the scope below (right-click / properties / and slide the ‘horizontal scale’).</p>
<p>How does the frequency of the signal relate to how much current crosses either the capacitor or the resistor?</p>
</div>
<div class="tabox docutils container">
<p>1A. The current over the resistor becomes very small due to the increased resistance. There is a slight increase in current over the capacitor because impedances in parallel impedances diminish (through a reciprocal formula) to form the total impedance. See <a class="reference external" href="https://www.allaboutcircuits.com/textbook/alternating-current/chpt-4/parallel-resistor-capacitor-circuits/">here for more info</a></p>
<p>1B. More current travels through the capacitor, its impedance has been reduced.</p>
<p>1C. High frequencies  = low capacitor impedance = more current through capacitor relative to resistor. At 1 Hz the resistor has a higher max current.</p>
</div>
</section>
<section id="the-equivalent-circuit-of-the-electrode">
<h2><a class="toc-backref" href="#id2" role="doc-backlink">2. The equivalent circuit of the electrode</a><a class="headerlink" href="#the-equivalent-circuit-of-the-electrode" title="Permalink to this heading">#</a></h2>
<p>In the theory handout, we discussed how we can represent an electrode as a circuit containing a resistance and a capacitance. We’ll now build this equivalent circuit in the simulator.</p>
<div class="exercise docutils container">
<p>2A. In the simulator, edit the circuit used above to build the equivalent circuit of a polarised, tungsten electrode. See the theory handout for more details.</p>
<p>Here are some values to use:</p>
<ul class="simple">
<li><p>R<sub>m</sub>: the DC resistance of the metal electrode wire, 10-100 Ohms.</p></li>
<li><p>C<sub>e</sub>: the electrode tip capacitance, generated by the double layer generated around the electrode.  C<sub>e</sub> ~ 0.2 pF / µm2, so 10 - 20 pF (if the electrode is unplated)</p></li>
<li><p>R<sub>e</sub>: electrode tip resistance, in parallel with C<sub>e</sub>. ~ 100 MOhm.</p></li>
<li><p>Edit the alternating voltage supply to provide 1V at 1Khz, mimicking the signal coming from your cell. 1V is larger than ephys signals, but makes the current flow easier to see. Change the sliders for simulation speed and current speed until you can see where the current is flowing.</p></li>
</ul>
<p>2B. What happens if you delete the resistor R<sub>e</sub>?</p>
<p>2C. Bonus exercise: Can you change this circuit from a polarising, tungsten electrode, to a circuit representing a nonpolarizable electrode?</p>
</div>
<div class="tabox docutils container">
<p>2A:  Circuit of electrode: <a class="reference external" href="https://tinyurl.com/yzzjjvdk">https://tinyurl.com/yzzjjvdk</a></p>
<a class="reference external image-reference" href="https://tinyurl.com/yzzjjvdk"><img alt="../_images/electrode_eq_circuit.png" class="align-center" src="../_images/electrode_eq_circuit.png" /></a>
<p>2B: They should not see much difference if the electrode is only represented by capacitor, because the capacitance of a polarising electrode has the largest effect on the current due to the high resistance of the resistor.</p>
<p>2C: Reduce the resistance of Re until current can flow through Re.</p>
</div>
</section>
<section id="shunt-impedance">
<h2><a class="toc-backref" href="#id3" role="doc-backlink">3.  Shunt Impedance</a><a class="headerlink" href="#shunt-impedance" title="Permalink to this heading">#</a></h2>
<p>Here is the circuit of the electrode with a shunt impedance added of 100 pF:</p>
<a class="reference external image-reference" href="https://tinyurl.com/y2jshzqc"><img alt="../_images/day2circuit.png" class="align-center" src="../_images/day2circuit.png" /></a>
<div class="exercise docutils container">
<p>3A. What is shunt impedance here?</p>
<p>3B. What % of our signal are we losing between Vec and Vin? Why?</p>
<p>3C. What could we change to increase the signal at Vin?</p>
<p>3D. The tips of certain electrodes, e.g. nichrome tetrodes, can be electroplated in a thin layer of gold. This ‘goldplating’ increases the surface area of the tip, creating more space to separate charge. This increases tip capacitance by around 100x. Make this change in the circuit simulator. How similar are Vec and Vin now?</p>
</div>
<div class="tabox docutils container">
<p>3A: Shunt impedance = Shunt capacitance Csh +  shunt resistance Rsh. These are both routes to ground outside of the intended acquisition system. At the high frequencies (1kHz) we are interested in, the capacitive component will have low impedance, and will therefore have more effect than the resistive component, so Rsh is often ignored. Technically this is just the equivalent circuit of the electrode, so shunt impedance here would be the capacitance along the side of the electrode.</p>
<p>Remember that any two conducting surfaces, with a non-conducting layer in between, is a capacitor. Shunt capacitance arises mainly from the capacitance across the thin insulation layer isolating an electrode and the surrounding electrolyte, as well as the cumulative capacitance along cables and connectors (Robinson, 1968).</p>
<p>3B: There should be 655 mV left of our 5V signal. Vec = 5V, Vin = 655mV, we are losing 87% of our signal because the capacitor of our electrode and the shunt capacitance are forming a voltage divider.</p>
<p>3C:
We can change the impedance ratio to change the Vin.</p>
<div class="math notranslate nohighlight">
\[Vin = \frac{Zsh}{Ze+Zsh} Vec\]</div>
<p>We want Vec to be multiplied by a ratio that is close as possible to 1. We can do that by decreasing Ze (the impedance of the electrode) by <em>increasing</em> the capacitance of the electrode. There’s not much we can do to increase Zsh, though in theory that would help; we essentially do this by designing high input impedance amplifiers.</p>
<p>3D: Gold plated electrode circuit: the increased capacitance decreases impedance.  Circuit here: <a class="reference external" href="https://tinyurl.com/y6p3trme">https://tinyurl.com/y6p3trme</a>. Students can get impedance and capacitance mixed up and forget they go in opposite directions.</p>
</div>
<section id="recording-circuit">
<h3><a class="toc-backref" href="#id4" role="doc-backlink">Recording Circuit</a><a class="headerlink" href="#recording-circuit" title="Permalink to this heading">#</a></h3>
<p>To actually perform a recording, we will have to attach the electrode to the rest of an acquisition system. The recording system has an analog to digital converter (ADC), and a recording computer.  The leakage resistance here is where the recording system is connected to ground.</p>
<a class="reference external image-reference" href="https://tinyurl.com/y6864vle"><img alt="../_images/day2withac.png" class="align-center" src="../_images/day2withac.png" /></a>
<div class="exercise docutils container">
<p>3E. How much of the voltage at the electrode, Vec, are we recording at Vout?</p>
<p>3F. Add a headstage to this circuit, by placing an ideal operational amplifier between the electrode and the long wire. What happens to Vout? Why?</p>
<p>3G. Change the circuit to stop the amplifier from saturating. What is the amplifier gain now?</p>
</div>
<div class="tabox docutils container">
<p>3E:</p>
<ul class="simple">
<li><p>Vec = 1V</p></li>
<li><p>Vout = 5.027 mV</p></li>
<li><p>We are recording 0.5%</p></li>
</ul>
<p>3F:</p>
<p>Place op amp through:</p>
<p>Menu/Active construction blocks/OpAmp.
Result: <a class="reference external" href="https://tinyurl.com/y68o5n4o">https://tinyurl.com/y68o5n4o</a>
Some students will already put the negative feedback in here, just make sure they understand why and what happens without it. Without negative feedback:</p>
<p>Vout hits +- 15V, it is saturating to the value of the power rails, because it has very very high gain. It is calculating the difference between + and - multiplying it by its huge gain.</p>
<p>3G:</p>
<a class="reference external image-reference" href="https://tinyurl.com/y454jqlb"><img alt="../_images/sim_headstage_added.png" class="align-center" src="../_images/sim_headstage_added.png" /></a>
<p>We need to do something to prevent our amplifier from always hitting power-rail values. We can provide negative feedback to the amplifier by looping the output back and feeding it into one of the terminals. Connect the amplifier output to the inverting input. The amplifier is going to do the same thing as before; output the difference between + and - multiplied by its huge gain. The output will rise rapidly, however this time, as soon as it reaches the value of the + terminal, the + and – are the same value and there’s no difference left to amplify.</p>
<p>Now we’re just seeing our input signal replicated at the output of the amplifier with a gain of 1.</p>
</div>
</section>
</section>
<section id="operational-amplifiers">
<h2><a class="toc-backref" href="#id5" role="doc-backlink">4. Operational Amplifiers</a><a class="headerlink" href="#operational-amplifiers" title="Permalink to this heading">#</a></h2>
<p>In the simulator, ‘ideal’ operational amplifiers are shown without their power supplies. However in real life, we need to provide our op-amp with power. We will use batteries to make voltage ‘rails’. We are going to make a -3V and +3V rail using simulated AA batteries that provide 1.5V each.</p>
<p>To do this we use a common trick and turn two regular power supplies into a bipolar power supply.</p>
<img alt="../_images/bipolar_power_supply.png" class="align-center" src="../_images/bipolar_power_supply.png" />
<div class="exercise docutils container">
<p>4D. Using 4x 1.5 DC voltage supplies simulated batteries, connect them together so that you have a +3, 0, and -3 power supply.</p>
<a class="reference external image-reference" href="https://tinyurl.com/yyo6n35w"><img alt="../_images/aa_batteries_sim.png" class="align-center" src="../_images/aa_batteries_sim.png" /></a>
<p>4E. Replace the ‘ideal’ op-amp with a ‘real’ op amp in the simulator. Use a bipolar power supply to power it. What amplitude values do you get as output now? How is it different to the ideal op amp?</p>
</div>
<div class="tabox docutils container">
<p>4D.</p>
<a class="reference external image-reference" href="https://tinyurl.com/yyltu6sb"><img alt="../_images/bipolar_sim_solution.png" class="align-center" src="../_images/bipolar_sim_solution.png" /></a>
<p>4E.</p>
<p>This is using a single voltage supply to represent each pair of batteries:</p>
<a class="reference external image-reference" href="https://tinyurl.com/y25z3vzh"><img alt="../_images/bipolar_supply_sim.png" class="align-center" src="../_images/bipolar_supply_sim.png" /></a>
</div>
<section id="bypass-capacitors">
<h3><a class="toc-backref" href="#id6" role="doc-backlink">Bypass capacitors</a><a class="headerlink" href="#bypass-capacitors" title="Permalink to this heading">#</a></h3>
<p>Bypass capacitors are small capacitors that act like little secondary batteries. The batteries we use have a high ESR - ‘equivalent series resistance’, and some capacitance. This means that are not great at quickly providing current. Because of this, when our op-amp starts working, it can run out of current for a very short time until the battery can drive the rails back to their original voltage. This is bad for the signal quality.</p>
<p>So, we allow these small capacitors to charge. If the battery briefly can’t provide current, the bypass capacitors will discharge, providing quick back-up current. We’re exploiting the fact that these caps have very low ESR and can provide current pretty much instantaneously. The fact that they’re too small to power anything for more than a millisecond does not matter here, at that point the batteries have caught up.</p>
<div class="exercise docutils container">
<p>4F. Add bypass capacitors to the simulation based on where they are in the bipolar power supply pictured here:</p>
<blockquote>
<div><a class="reference external image-reference" href="https://tinyurl.com/y25z3vzh"><img alt="../_images/fritz_bipolar_power_supply.png" class="align-center" src="../_images/fritz_bipolar_power_supply.png" /></a>
</div></blockquote>
</div>
<div class="tabox docutils container">
<p>4F. <a class="reference external" href="https://tinyurl.com/yxqwgd9u">https://tinyurl.com/yxqwgd9u</a></p>
</div>
</section>
</section>
</section>


              </article>
              

              
              <footer class="bd-footer-article">
                  <!-- Previous / next buttons -->
<div class='prev-next-area'>
</div>
              </footer>
              
          </div>
          
      </div>
    </div>

  
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=92025949c220c2e29695"></script>

<footer class="bd-footer"><div class="bd-footer__inner container">
  
  <div class="footer-item">
    <p class="copyright">
    &copy; Copyright 2010-2022, Open Ephys, OEPS &amp; Contributors.<br>
</p>
  </div>
  
  <div class="footer-item">
    <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 5.0.2.<br>
</p>
  </div>
  
</div>
</footer>
  </body>
</html>