
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Exercises Day 3 &#8212; Open Ephys EEA 2022  documentation</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.png"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
    
    <div class="container-fluid" id="banner"></div>

    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="container-xl">

  <div id="navbar-start">
    
    

<a class="navbar-brand" href="../index.html">
  <img src="../_static/oe_logo_course.svg" class="logo" alt="logo">
</a>


    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    
    
    <li class="nav-item">
        <a class="nav-link nav-external" href="https://open-ephys.org">Open Ephys<i class="fas fa-external-link-alt"></i></a>
    </li>
    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          <a class="nav-link" href="https://github.com/ahleighton/OE-ephys-course" rel="noopener" target="_blank" title="GitHub"><span><i class="fab fa-github"></i></span>
            <label class="sr-only">GitHub</label></a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="https://twitter.com/openephys" rel="noopener" target="_blank" title="Twitter"><span><i class="fab fa-twitter"></i></span>
            <label class="sr-only">Twitter</label></a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="https://discord.gg/vSg5UDcCwB" rel="noopener" target="_blank" title="Discord"><span><i class="fab fa-discord"></i></span>
            <label class="sr-only">Discord</label></a>
        </li>
      </ul>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
            
            <!-- Only show if we have sidebars configured, else just a small margin  -->
            <div class="col-12 col-md-3 bd-sidebar">
              <div class="sidebar-start-items"><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    
  </div>
</nav>
              </div>
              <div class="sidebar-end-items">
              </div>
            </div>
            
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
            
              
              <div class="toc-item">
                
<div class="tocsection onthispage mt-5 pt-1 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#differential-signals">
   1. Differential Signals
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#reference-electrode">
   2. Reference electrode
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#emg-circuit">
   3. EMG circuit
  </a>
 </li>
</ul>

</nav>
              </div>
              
              <div class="toc-item">
                

<div class="tocsection editthispage">
    <a href="https://github.com/ahleighton/OE-ephys-course/edit/main/source/EEA/exday3.rst">
        <i class="fas fa-pencil-alt"></i> Edit this page
    </a>
</div>

              </div>
              
            
          </div>
          

          
          
            
          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <section id="exercises-day-3">
<span id="refeday3"></span><h1>Exercises Day 3<a class="headerlink" href="#exercises-day-3" title="Permalink to this headline">#</a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#differential-signals" id="id1">1. Differential Signals</a></p></li>
<li><p><a class="reference internal" href="#reference-electrode" id="id2">2. Reference electrode</a></p></li>
<li><p><a class="reference internal" href="#emg-circuit" id="id3">3. EMG circuit</a></p></li>
</ul>
</div>
<section id="differential-signals">
<h2><a class="toc-backref" href="#id1">1. Differential Signals</a><a class="headerlink" href="#differential-signals" title="Permalink to this headline">#</a></h2>
<div class="exercise docutils container">
<p>1A.   Use the oscilloscope 1x probe to measure the electrical noise in your environment, for instance by touching the probe tip. How big is the amplitude of this signal? Compare this to the size of a spike, around 100 µV. Could you see a spike on top of that noise?</p>
</div>
</section>
<section id="reference-electrode">
<h2><a class="toc-backref" href="#id2">2. Reference electrode</a><a class="headerlink" href="#reference-electrode" title="Permalink to this headline">#</a></h2>
<p>So far, we have only considered the signal coming into our recording electrode, relative to ground. We will now add a reference electrode in the simulator.</p>
<p>You can think of the small square waves as spikes you are trying to detect, and the sine wave (that both reference and your measurement electrode share) as the background. This background could be slow EEG signals or 50Hz noise, which is likely to be present at both electrodes.</p>
<p>Step-by-step, we are going to build our ‘goal’ circuit has the following properties:</p>
<ul class="simple">
<li><p>Input from a measurement electrode (spikes)</p></li>
<li><p>Input from a reference electrode (common noise)</p></li>
<li><p>Output: Reference subtracted from measurement, multiplied by gain</p></li>
<li><p>Does not draw current from the electrode</p></li>
</ul>
<a class="reference external image-reference" href="https://www.falstad.com/circuit/circuitjs.html?ctz=CQAgjCAMB0l3BWcBmWBOA7AFjA5AmMSADjGIDYIFIQlraBTAWjDACgBDEJ5ZckfCW6DiAoaNzdJReHCjyZ8NgHkQyYlgFYaWAlpoRIbAErDiorGn49BIS-wMhyNJDTfQEbAG7D8m+2YWVvL44PBQsIbyMOwAHnZgoWRodlhIYGihmn4gAAoAwmwARmoa4Fj+GDT4xMhQbPE8CP54UsgQafzZmgBCHADGANYA5gBOAPYArgB2ACYAOgDO8wAOS4srAJaDDIsN3MiWavihLOQpBEjdIMYMAGYMowzT-Qzrm8PTHAA2JsIYoT4oh4kE0QIUThc0QinkaBCSWAwvhSuB0WhAAEEALYrb6bO6bR5sADu-0B5GBfho4KMjSw+DoGGsGUZKWuAElpitJgAXJZgJYACh6AHElqslgBlLY7RYASn2TE0CAw6W0tAwFnRnO5fMW+CFxgAogAxBXxen8BDkOjNWgUuzogpC5S83UK0lME7+YIsTJ2YJGcblJyaHSQNAo9yyTA28gMkIh5BsYNEUPybSR2gRGNM60JiBJakp8Dp8NZmCyJn4NDINBpdoJmICcBsIA"><img alt="../_images/sim_reference_electrode.png" class="align-center" src="../_images/sim_reference_electrode.png" /></a>
<div class="exercise docutils container">
<p>2A. Connect the reference and spike signal to the op-amp in open-loop configuration to subtract the reference. Connect the output of the amplifier to the PC. Run the simulation. What (in V) is the amplifier giving as output?</p>
<p>2B. Try adding a wire (with no resistors) as a negative feedback connection to stop the amplifier from saturating. Why does this not work?</p>
<p>2C. Using two resistors to make a voltage divider on each side of the ‘-’ input.
What is the output now?</p>
<p>2D. We’re still not outputting our spikes. What went wrong?
Try to figure this out but talk to a classmate or a TA if you get stuck.</p>
<p><strong>Check that your have a correct differential amplifier circuit before moving on.</strong></p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>2E. In the simulator we are working with ‘perfect’ components. In real life, these parts have to be physically produced and have certain degrees of precision, called ‘tolerances’. A resistance with 10% tolerance can be 10% higher or lower than the stated value.
Simulate a case in which one of the resistors in the differential amplifier is 10% higher and another is 10% lower. What happens?</p>
<p>2F.</p>
<p>Setup: Return the resistors to balanced values. Now add resistors directly after the input signals, to act as your electrode (for both the signal and reference). You can simplify the electrode to a 300kOhm resistor, or a 800 pF capacitor if you prefer.</p>
<p>What happens to the signal if there is a 5% difference between the impedance of your 2 electrodes?
Can we use this shiny new differential amplifier to record neural signals?</p>
</div>
<p>We worked hard to avoid drawing current from our frail electrode signal, and now we’re telling you to put big voltage dividers right at the inputs of our op-amp? That seems bad.</p>
<p>Also, as we’ve just simulated, often op-amps do not have equal input impedances across their inputs, in fact in practise it is often impossible to exactly match impedances. If you’ve ever measured electrode impedance, you will have noticed that there is always some slight variation in impedance. To get this differential amplifier to work, each electrode and resistor would have to be identical, which is, in practice, impossible.</p>
<div class="exercise docutils container">
<p>2G. How do we fix this issue? We want to:</p>
<ul class="simple">
<li><p>Preserve the differential properties of the amplifier we just built</p></li>
<li><p>Not have voltage dividers sending part of our precious signal to ground</p></li>
<li><p>Not be sensitive to small differences in resistor impedance</p></li>
</ul>
<p>Discuss this with your group or TA if necessary, and try to build that circuit.</p>
</div>
</section>
<section id="emg-circuit">
<h2><a class="toc-backref" href="#id3">3. EMG circuit</a><a class="headerlink" href="#emg-circuit" title="Permalink to this headline">#</a></h2>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Your kit contains surface electrodes that we will use for EMG. These measurements involve attaching yourself to a circuit, so follow these rules to be safe:</p>
<ol class="upperalpha simple">
<li><p>Do not use anything other than the recommended batteries to power your circuit. Do not connect your circuit to mains supply for power, ground, anything.</p></li>
<li><p>Only connect the EMG electrodes to one arm. Don’t attach them to both arms. This is to avoid any current travelling across your heart.</p></li>
<li><p>If you are using a laptop, disconnect your laptop charger &amp; run from battery while the electrodes are attached to you. This is to prevent any surges from mains supply from backpropagating through your laptop, to you.</p></li>
</ol>
</div>
<p>We now have all the steps of the acquisition in place to simulate a lab experiment. We are going to build an EMG circuit on the breadboard, using:</p>
<ul class="simple">
<li><p>The electrodes in your kit. The disposable electrodes in the kit are single-use, so do not attach them until you are sure your circuit is working and that you have the correct position (see below).</p></li>
<li><p>The electrodes clip onto the cable with three wires. We’ll be using an audio-to-breadboard jack to get the signal from the electrodes into the breadboard.</p></li>
<li><p>An instrumentation amplifier as our ‘headstage’. <a class="reference external" href="https://www.ti.com/lit/ds/symlink/ina129-ep.pdf?ts=1636717545454&amp;ref_url=https%253A%252F%252Fwww.google.com%252F">This</a> is the datasheet for the instrumentation amplifier in your kit.</p></li>
</ul>
<img alt="../_images/instr_amp_pinout.png" class="align-center" src="../_images/instr_amp_pinout.png" />
<ul class="simple">
<li><p>We will first test the circuit using the Picoscope to read out the signal. Tomorrow, we will use the Teensy as our acquisition board to digitize the data.</p></li>
</ul>
<div class="exercise docutils container">
<p>3A. Replicate the following circuit:</p>
<img alt="../_images/fritz_emg_picoscope.png" class="align-center" src="../_images/fritz_emg_picoscope.png" />
<ul class="simple">
<li><p>Bypass capacitors = ‘104’</p></li>
<li><p>Gain resistor: 220 Ohm</p></li>
</ul>
<img alt="../_images/emg_gain_resistor.png" class="align-center" src="../_images/emg_gain_resistor.png" />
<p>3B. Now attach the surface electrodes onto the ends of the electrode cable, and click the jack into the breadboard adaptor.</p>
<p>Each electrode corresponds to a different pin on the breadboard adaptor:</p>
<ul class="simple">
<li><p>Black cable = ground electrode = Ring 2</p></li>
<li><p>Blue cable = ‘-’ (reference) electrode  = Ring 1</p></li>
<li><p>Red cable = ‘+’ electrode = Tip</p></li>
</ul>
<p>3C. Attach your oscilloscope as shown:</p>
<img alt="../_images/board_emg_picoscope.png" class="align-center" src="../_images/board_emg_picoscope.png" />
<p>If you tap the electrodes, you should see the trace of your PicoScope respond. Troubleshoot your circuit until you do. Make sure your Picoscope responds to tapping your electrodes before continuing, and ask a TA for help if you get stuck.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>3D.</p>
<p>Place the measurement and reference electrode very close together, on the part of the forearm where you can feel a muscle when tensed. Place the ground on the elbow, where you can feel bone.  You should see a clear signal in the oscilloscope when you tense your muscles. Moving your arm will cause large motion artefacts so try to find a setup that gives you a consistent and clear signal.</p>
<img alt="../_images/arm.png" class="align-center" src="../_images/arm.png" />
<p>The resistor across the instrumentation amplifier sets the gain of the amplifier. Change the gain of the amplifier by changing Rg. What happens when the value for Rg is very low?</p>
</div>
</section>
</section>


              </div>
              
              
              <!-- Previous / next buttons -->
<div class='prev-next-area'>
</div>
              
          </main>
          

      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>
<footer class="footer mt-5 mt-md-0">
  <div class="container">
    
    <div class="footer-item">
      <p class="copyright">
    &copy; Copyright 2010-2024, Open Ephys, OEPS &amp; Contributors.<br>
</p>
    </div>
    
    <div class="footer-item">
      <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.5.0.<br>
</p>
    </div>
    
  </div>
</footer>
  </body>
</html>